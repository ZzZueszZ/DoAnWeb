<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{base::layout(~{::section})}">
<head>
<meta charset="UTF-8">
<title>Product</title>

<style>

.list-group-item.active {
    z-index: 2;
    
    background-color: #DC3545;
    border-color: #DC3545;
}

element.style {
    z-index: 2;
    /* color: #DC3545; */
    background-color: #DC3545;
    border-color: #DC3545;
}

.product-card {
    transition: transform 0.2s;
    border: none;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
}

.product-img-container {
    height: 180px; /* Giảm chiều cao container ảnh */
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    margin-bottom: 10px;
}

.product-img {
    max-height: 100%;
    object-fit: contain;
    width: auto;
}

.product-title {
    height: 48px;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    font-size: 1rem;
    margin-bottom: 10px;
    color: #333;
    font-weight: 500;
    border-bottom: 1px solid #eee;
    padding-bottom: 8px;
}

.card-body {
    padding-top: 0;
}

.badge {
    font-weight: 500;
    padding: 5px 10px;
}

/* Responsive */
@media (max-width: 768px) {
    .col-md-3 {
        padding: 10px;
    }
    
    .product-img-container {
        height: 160px;
    }
    
    .product-title {
        font-size: 0.9rem;
        height: 42px;
    }
}

.form-select-sm {
    min-width: 70px;
    padding: 0.25rem 1.5rem 0.25rem 0.5rem;
}

</style>
</head>
<body>
	<section>f
		<div class="container-fluid bg-danger p-5">
			<div class="row">
				<div class="col-md-8 offset-md-2">
					<form th:action="@{/products}" method="get">
						<div class="input-group">
							<input class="form-control" type="text" name="search" 
								   th:value="${param.search}" placeholder="Search by product name...">
							<button class="btn btn-light text-dark ms-3 col-md-2" type="submit">
								<i class="fa-solid fa-magnifying-glass"></i> Search Product
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<!-- category side bar start -->
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-2 mt-1 p-0">
					<div class="card shadow-sm p-0 mb-5 bg-body-tertiary rounded">
						<div class="card-body">
							<div class="list-group">
								<p class="fs-5">Category</p>
								<a href="/products" class="list-group-item list-group-item-action"
									th:classappend="${paramValue == ''} ? 'active' : ''"
									aria-current="true"> All </a> 
								
								<a href="#" th:each="category : ${allActiveCategory}" th:href="@{'/products?category='+${category.categoryName}}"
								    th:classappend="${paramValue == category.categoryName} ? 'active' : '' "
									class="list-group-item list-group-item-action">[[${category.categoryName}]]</a>
								
							</div>

						</div>
					</div>
					
				</div>

				<div class="col-md-10">
					<div class="card mt-1 shadow-sm p-3 mb-5 bg-body-tertiary rounded">
						<div class="card-body">
							<p class="fs-3 text-center">Products</p>
							
							<!-- Hiển thị kết quả tìm kiếm nếu có -->
							<div th:if="${searchTerm != null}" class="mb-4 text-center">
								<p class="text-muted">
									Search results for: <span class="fw-bold" th:text="${searchTerm}"></span>
								</p>
							</div>

							<div class="row g-4"> <!-- Thêm g-4 để tạo khoảng cách giữa các card -->
								<th:block th:if="${not #lists.isEmpty(allActiveProducts)}">
									<div class="col-md-3" th:each="product : ${allActiveProducts}">
										<div class="card h-100 product-card shadow-sm">
											<h5 class="card-title text-center product-title mt-2 px-2" 
												th:text="${product.productTitle}">
											</h5>
											<div class="product-img-container">
												<img alt="product_image"
													th:src="@{${product.productImage}}"
													class="card-img-top product-img">
											</div>
											<div class="card-body d-flex flex-column">
												<div class="mt-auto">
													<div class="text-center mb-3">
														<th:block th:if="${product.discount > 0}">
															<span class="fs-5 fw-bold text-danger">৳[[${product.discountPrice}]]</span>
															<br>
															<span class="text-decoration-line-through text-secondary">
																৳[[${product.productPrice}]]
															</span>
															<span class="badge bg-success ms-2">
																[[${product.discount}]]% Off
															</span>
														</th:block>
														
														<th:block th:unless="${product.discount > 0}">
															<span class="fs-5 fw-bold">৳[[${product.productPrice}]]</span>
														</th:block>
													</div>
													<a th:href="@{'/product/'+${product.id}}"
														class="btn btn-danger w-100">View Details</a>
												</div>
											</div>
										</div>
									</div>
								</th:block>
								
								<div th:if="${#lists.isEmpty(allActiveProducts)}" 
									 class="col-12 text-center">
									<div class="alert alert-info">
										<i class="fas fa-info-circle me-2"></i>
										No products found!
									</div>
								</div>
							</div>

							<div th:if="${totalPages > 1}" class="row mt-4">
								<div class="col-12">
									<!-- Dropdown chọn số items/trang -->
									<div class="d-flex justify-content-center align-items-center mb-3">
										<span class="me-2">Items per page:</span>
										<select class="form-select form-select-sm" style="width: auto;"
												onchange="changePageSize(this.value)">
											<option th:each="s : ${pageSizes}" 
													th:value="${s}"
													th:text="${s}"
													th:selected="${s == pageSize}">
											</option>
										</select>
									</div>

									<!-- Phân trang -->
									<nav aria-label="Page navigation">
										<ul class="pagination justify-content-center">
											<!-- Previous -->
											<li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
												<a class="page-link" 
												   th:href="@{'/products'(page=${currentPage - 1}, size=${pageSize}, category=${paramValue}, search=${searchTerm})}"
												   tabindex="-1">Previous</a>
											</li>
											
											<!-- Page Numbers -->
											<li class="page-item" 
												th:each="pageNumber : ${#numbers.sequence(1, totalPages)}"
												th:classappend="${pageNumber == currentPage} ? 'active'">
												<a class="page-link" 
												   th:href="@{'/products'(page=${pageNumber}, size=${pageSize}, category=${paramValue}, search=${searchTerm})}"
												   th:text="${pageNumber}"></a>
											</li>
											
											<!-- Next -->
											<li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
												<a class="page-link" 
												   th:href="@{'/products'(page=${currentPage + 1}, size=${pageSize}, category=${paramValue}, search=${searchTerm})}">Next</a>
											</li>
										</ul>
									</nav>
									
									<!-- Thông tin phân trang -->
									<div class="text-center text-muted">
										Showing page [[${currentPage}]] of [[${totalPages}]] 
										([[${totalItems}]] items total)
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- category side bar end -->
		<script>
		element.style.zIndex = 2;
		element.style.backgroundColor = "#DC3545";
		element.style.borderColor = "#DC3545";
		</script>

		<!-- Thêm JavaScript để xử lý thay đổi page size -->
		<script th:inline="javascript">
		function changePageSize(size) {
			let currentUrl = new URL(window.location.href);
			let params = new URLSearchParams(currentUrl.search);
			
			// Giữ nguyên các parameter hiện tại
			params.set('size', size);
			params.set('page', '1'); // Reset về trang 1 khi đổi size
			
			// Chuyển hướng với params mới
			window.location.href = '/products?' + params.toString();
		}
		</script>
	</section>
</body>
</html>